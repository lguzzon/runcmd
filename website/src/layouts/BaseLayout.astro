---
import '../styles/global.css'

const {
  title = 'RunCmd',
  description = 'Universal Script Runner for Modern Devs',
} = Astro.props
---
<!DOCTYPE html>
<html lang="en" class="bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/runcmd/favicon.svg" />
    <script>
      (() => {
        try {
          const stored = localStorage.getItem('theme')
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isDark = stored
            ? stored === 'dark'
            : typeof prefersDark === 'boolean'
              ? prefersDark
              : true
          document.documentElement.classList.toggle('dark', isDark)
          document.documentElement.dataset.theme = isDark ? 'dark' : 'light'
          
          // Initialize button state
          const toggle = document.querySelector('[data-theme-toggle]')
          if (toggle) {
            toggle.setAttribute('aria-pressed', String(isDark))
          }
        } catch (error) {
          console.error('Theme init failed', error)
        }
      })()
    </script>
  </head>
  <body class="min-h-screen bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 antialiased">
    <slot />
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const toggle = document.querySelector('[data-theme-toggle]')
        if (!toggle) return

        const updateState = (isDark) => {
          document.documentElement.classList.toggle('dark', isDark)
          document.documentElement.dataset.theme = isDark ? 'dark' : 'light'
          try {
            localStorage.setItem('theme', isDark ? 'dark' : 'light')
          } catch (error) {
            console.warn('localStorage not available:', error)
          }
          toggle.setAttribute('aria-pressed', String(isDark))
        }

        toggle.addEventListener('click', () => {
          const next = !document.documentElement.classList.contains('dark')
          updateState(next)
        })
      })
    </script>
  </body>
</html>